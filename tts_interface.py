# -*- coding: utf-8 -*-
"""TTS_Interface.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/174iBsM96hsQReann2EYZP1mZPu8exoL1
"""

import streamlit as st
from PIL import Image
import pytesseract
from gtts import gTTS
import os
import base64

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙØ­Ø©
st.set_page_config(page_title="Text to Speech App", layout="centered")

st.title("ğŸ”Š ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ØµÙˆØª")
st.write("Ø§Ø®ØªØ± Ø¥Ø¯Ø®Ø§Ù„ ØµÙˆØ±Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†Øµ Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ ÙŠØ¯ÙˆÙŠÙ‹Ø§ØŒ Ø«Ù… Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù….")

# Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
option = st.radio("Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„:", ["ğŸ“· Ø¥Ø¯Ø®Ø§Ù„ ØµÙˆØ±Ø©", "âœï¸ ÙƒØªØ§Ø¨Ø© Ù†Øµ ÙŠØ¯ÙˆÙŠÙ‹Ø§"])

# Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ©
# Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù„ØºØ§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø© ÙÙŠ Tesseract
available_langs = pytesseract.get_languages(config='')
lang = st.selectbox("Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©:", options=available_langs, index=available_langs.index("ara") if "ara" in available_langs else 0)


# Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Øµ Ø£Ùˆ Ø§Ù„ØµÙˆØ±Ø©
text = ""

if option == "ğŸ“· Ø¥Ø¯Ø®Ø§Ù„ ØµÙˆØ±Ø©":
    uploaded_image = st.file_uploader("Ø§Ø±ÙØ¹ ØµÙˆØ±Ø©", type=["png", "jpg", "jpeg"])
    if uploaded_image is not None:
        image = Image.open(uploaded_image)
        st.image(image, caption="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªÙŠ ØªÙ… Ø±ÙØ¹Ù‡Ø§", use_column_width=True)
        text = pytesseract.image_to_string(image, lang=lang)
        st.success("âœ… ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©.")

elif option == "âœï¸ ÙƒØªØ§Ø¨Ø© Ù†Øµ ÙŠØ¯ÙˆÙŠÙ‹Ø§":
    text = st.text_area("Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§:")

# Ø²Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„
if st.button("ğŸ¤ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ØµÙˆØª"):
    if text.strip() == "":
        st.error("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ù†ØµÙ‹Ø§ Ø£ÙˆÙ„Ø§Ù‹.")
    else:
        tts = gTTS(text, lang=lang)
        tts.save("output.mp3")
        st.audio("output.mp3", format="audio/mp3", start_time=0)

        # Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
        with open("output.mp3", "rb") as audio_file:
            audio_bytes = audio_file.read()
            b64 = base64.b64encode(audio_bytes).decode()
            href = f'<a href="data:audio/mp3;base64,{b64}" download="output.mp3">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª</a>'
            st.markdown(href, unsafe_allow_html=True)